{
  "version": 3,
  "sources": ["../../../../src/routes/normal/transactions/search.ts"],
  "sourcesContent": ["import { HTTPRouteFile } from \"@/interfaces/Webserver\"\n\ninterface Body { }\n\nimport { QueryResult } from \"pg\"\n\nexport = {\n\tmethod: 'GET',\n\tpath: '/transactions/search',\n\n\tasync code(ctr) {\n\t\t// Check for Headers\n\t\tif (\n\t\t\t!ctr.headers.get('senderid') ||\n\t\t\t!ctr.headers.get('recieverid') ||\n\t\t\t!ctr.headers.get('maxresults')\n\t\t) return ctr.status(422).print({ success: false, message: 'NO HEADERS' })\n\n\t\t// Fetch Transactions\n\t\tlet rawvalues: QueryResult\n\t\tif (ctr.headers.get('senderid') !== 'empty' && ctr.headers.get('recieverid') !== 'empty') {\n\t\t\trawvalues = await ctr['@'].db.query(`select * from usertransactions where senderid = $1 and recieverid = $2 order by timestamp desc;`, [\n\t\t\t\tctr.headers.get('senderid'),\n\t\t\t\tctr.headers.get('recieverid')\n\t\t\t])\n\t\t} else if (ctr.headers.get('senderid') !== 'empty' && ctr.headers.get('recieverid') === 'empty') {\n\t\t\trawvalues = await ctr['@'].db.query(`select * from usertransactions where senderid = $1 order by timestamp desc;`, [\n\t\t\t\tctr.headers.get('senderid')\n\t\t\t])\n\t\t} else if (ctr.headers.get('senderid') === 'empty' && ctr.headers.get('recieverid') !== 'empty') {\n\t\t\trawvalues = await ctr['@'].db.query(`select * from usertransactions where recieverid = $1 order by timestamp desc;`, [\n\t\t\t\tctr.headers.get('recieverid')\n\t\t\t])\n\t\t} else {\n\t\t\trawvalues = await ctr['@'].db.query(`select * from usertransactions order by timestamp desc;`)\n\t\t}\n\n\t\t// Generate JSON Object\n\t\tconst transactions = []; let count = 0\n\t\tfor (const transaction of rawvalues.rows) {\n\t\t\tif (++count > Number(ctr.headers.get('maxresults'))) break\n\n\t\t\tconst senderInfo = await ctr['@'].bot.userdb.get(transaction.senderid)\n\t\t\tconst recieverInfo = await ctr['@'].bot.userdb.get(transaction.recieverid)\n\n\t\t\ttransactions.push({\n\t\t\t\tid: transaction.id,\n\t\t\t\ttimestamp: Number(transaction.timestamp),\n\t\t\t\tsender: {\n\t\t\t\t\tid: transaction.senderid,\n\t\t\t\t\tusername: senderInfo.username,\n\t\t\t\t\tusertag: senderInfo.usertag,\n\t\t\t\t\tavatar: senderInfo.avatar,\n\t\t\t\t\tamount: Number(transaction.senderamount),\n\t\t\t\t\ttype: transaction.sendertype\n\t\t\t\t}, reciever: {\n\t\t\t\t\tid: transaction.recieverid,\n\t\t\t\t\tusername: recieverInfo.username,\n\t\t\t\t\tusertag: recieverInfo.usertag,\n\t\t\t\t\tavatar: recieverInfo.avatar,\n\t\t\t\t\tamount: Number(transaction.recieveramount),\n\t\t\t\t\ttype: transaction.recievertype\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\t// Return Result\n\t\treturn ctr.print({\n\t\t\tsuccess: true,\n\t\t\tresults: transactions\n\t\t})\n\t}\n} as HTTPRouteFile<Body>"],
  "mappings": "AAMA,iBAAS;AAAA,EACR,QAAQ;AAAA,EACR,MAAM;AAAA,EAEN,MAAM,KAAK,KAAK;AAEf,QACC,CAAC,IAAI,QAAQ,IAAI,UAAU,KAC3B,CAAC,IAAI,QAAQ,IAAI,YAAY,KAC7B,CAAC,IAAI,QAAQ,IAAI,YAAY;AAC5B,aAAO,IAAI,OAAO,GAAG,EAAE,MAAM,EAAE,SAAS,OAAO,SAAS,aAAa,CAAC;AAGxE,QAAI;AACJ,QAAI,IAAI,QAAQ,IAAI,UAAU,MAAM,WAAW,IAAI,QAAQ,IAAI,YAAY,MAAM,SAAS;AACzF,kBAAY,MAAM,IAAI,GAAG,EAAE,GAAG,MAAM,mGAAmG;AAAA,QACtI,IAAI,QAAQ,IAAI,UAAU;AAAA,QAC1B,IAAI,QAAQ,IAAI,YAAY;AAAA,MAC7B,CAAC;AAAA,IACF,WAAW,IAAI,QAAQ,IAAI,UAAU,MAAM,WAAW,IAAI,QAAQ,IAAI,YAAY,MAAM,SAAS;AAChG,kBAAY,MAAM,IAAI,GAAG,EAAE,GAAG,MAAM,+EAA+E;AAAA,QAClH,IAAI,QAAQ,IAAI,UAAU;AAAA,MAC3B,CAAC;AAAA,IACF,WAAW,IAAI,QAAQ,IAAI,UAAU,MAAM,WAAW,IAAI,QAAQ,IAAI,YAAY,MAAM,SAAS;AAChG,kBAAY,MAAM,IAAI,GAAG,EAAE,GAAG,MAAM,iFAAiF;AAAA,QACpH,IAAI,QAAQ,IAAI,YAAY;AAAA,MAC7B,CAAC;AAAA,IACF,OAAO;AACN,kBAAY,MAAM,IAAI,GAAG,EAAE,GAAG,MAAM,yDAAyD;AAAA,IAC9F;AAGA,UAAM,eAAe,CAAC;AAAG,QAAI,QAAQ;AACrC,eAAW,eAAe,UAAU,MAAM;AACzC,UAAI,EAAE,QAAQ,OAAO,IAAI,QAAQ,IAAI,YAAY,CAAC;AAAG;AAErD,YAAM,aAAa,MAAM,IAAI,GAAG,EAAE,IAAI,OAAO,IAAI,YAAY,QAAQ;AACrE,YAAM,eAAe,MAAM,IAAI,GAAG,EAAE,IAAI,OAAO,IAAI,YAAY,UAAU;AAEzE,mBAAa,KAAK;AAAA,QACjB,IAAI,YAAY;AAAA,QAChB,WAAW,OAAO,YAAY,SAAS;AAAA,QACvC,QAAQ;AAAA,UACP,IAAI,YAAY;AAAA,UAChB,UAAU,WAAW;AAAA,UACrB,SAAS,WAAW;AAAA,UACpB,QAAQ,WAAW;AAAA,UACnB,QAAQ,OAAO,YAAY,YAAY;AAAA,UACvC,MAAM,YAAY;AAAA,QACnB;AAAA,QAAG,UAAU;AAAA,UACZ,IAAI,YAAY;AAAA,UAChB,UAAU,aAAa;AAAA,UACvB,SAAS,aAAa;AAAA,UACtB,QAAQ,aAAa;AAAA,UACrB,QAAQ,OAAO,YAAY,cAAc;AAAA,UACzC,MAAM,YAAY;AAAA,QACnB;AAAA,MACD,CAAC;AAAA,IACF;AAGA,WAAO,IAAI,MAAM;AAAA,MAChB,SAAS;AAAA,MACT,SAAS;AAAA,IACV,CAAC;AAAA,EACF;AACD;",
  "names": []
}
